<!--
System Management (SM) 
Copyright (C) 2022  D P Bennett & Associates Limited

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program.  If not, see <https://www.gnu.org/licenses/>.

Email: info@dpbennett.com.jm
-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://xmlns.jcp.org/jsf/html" 
    xmlns:p="http://primefaces.org/ui"
    xmlns:ui="http://java.sun.com/jsf/facelets"
 xmlns:f="http://xmlns.jcp.org/jsf/core"> 
    <h:head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />    
        <meta http-equiv="cache-control" content="max-age=0" />
        <meta http-equiv="cache-control" content="no-cache" />
        <meta http-equiv="expires" content="0" />
        <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
        <meta http-equiv="pragma" content="no-cache" />
        <title>#{systemManager.applicationHeader}</title>     
        <link rel="shortcut icon" type="image/x-icon" href="#{systemManager.appShortcutIconURL}" />
        <script type="text/javascript" src="js/javascripts.js" /> 
        <link rel="stylesheet" href="css/main.css" />
                  
    </h:head>
    <h:body>

        <ui:include src="common/commonDialogs.xhtml" />
        <ui:include src="admin/loginDialog.xhtml"/>  
        <ui:include src="common/userProfileDialog.xhtml"/> 

        <h:form id="appForm">          
            <p:splitter layout="vertical" rendered="#{systemManager.renderUserMenu()}">
                <p:splitterPanel size="100" >

                    <p:splitterPanel styleClass="p-d-flex p-ai-center p-jc-center" 
                                     size="20" minSize="20">

                        <p:growl id="growl3" life="5000" showDetail="true" />

                        <h:panelGrid columns="1" border="0" width="100%" >

                            <h:panelGrid width="100%" 
                                         border="0" columns="3" >

                                <p:graphicImage value="#{systemManager.logoURL}"
                                                height="#{systemManager.logoURLImageHeight}" 
                                                width="#{systemManager.logoURLImageWidth}"/>

                                <h:panelGrid columns="1">   

                                    <p:outputLabel value="#{systemManager.applicationHeader}"
                                                  style="color: darkgrey; font-size: 14pt; font-weight: bold;" />

                                    <p:outputLabel value="#{systemManager.applicationSubheader}"
                                                  styleClass="#{systemManager.isDebugMode eq true ? 'debug-mode' : 'non-debug-mode'}" />  

                                </h:panelGrid>
                                <h:panelGroup style="float: right;">
                                    <p:badge value="#{systemManager.sizeOfActiveNotifications}" 
                                             id="notificationBadge"
                                             visible="#{systemManager.hasActiveNotifications}" 
                                             severity="danger">

                                        <p:commandButton id="notifications" 
                                                         icon="pi pi-bell" />
                                        <p:overlayPanel for="notifications"   
                                                        widgetVar="NotificationPanelVar"
                                                        style="width:400px;border: 0;">
                                            <p:orderList value="#{systemManager.notifications}" 
                                                         var="notification" 
                                                         itemValue="#{notification}"
                                                         converter="#{notificationConverter}" 
                                                         controlsLocation="none" responsive="true" >

                                                <p:ajax event="select" 
                                                        update=":appForm:notificationBadge"
                                                        oncomplete="PF('NotificationPanelVar').hide()"
                                                        listener="#{systemManager.onNotificationSelect}" />
           
                                                <p:column>
                                                    <p:outputLabel value="#{notification.name}" 
                                                                  style="#{notification.style}"/>
                                                </p:column>                                           

                                            </p:orderList>
                                        </p:overlayPanel>

                                    </p:badge>
                                    <p:spacer width="30"/>
                                    <p:menuButton iconPos="left"
                                                  icon="pi pi-user"
                                                  title="#{systemManager.user.employee.firstName} #{systemManager.user.employee.lastName} (#{systemManager.user.username})"
                                                  id="userMenu"
                                                  style="margin-right: 15px;" >

                                        <p:menuitem actionListener="#{systemManager.viewUserProfile}"                                            
                                                    update=":userProfileDialogForm"
                                                    oncomplete="PF('userProfileDialog').show();"
                                                    icon="pi pi-cog"
                                                    value="Profile"
                                                    process="@this"/>
                                        <p:separator />  
                                        <p:menuitem actionListener="#{systemManager.logout}"                                             
                                                    icon="pi pi-sign-out"
                                                    value="Logout"
                                                    oncomplete="window.location.reload();"
                                                    process="@this"/>    

                                    </p:menuButton>   
                                </h:panelGroup>
                            </h:panelGrid> 

                        </h:panelGrid>

                    </p:splitterPanel>                          

                </p:splitterPanel>
                <p:splitterPanel>
                    <p:splitter>
                        <p:splitterPanel styleClass="p-d-flex p-ai-center p-jc-center" 
                                         size="32" minSize="0">
                            <p:panel id="dashboardPanel" header="Dashboard">
                                <p:commandButton
                                    id="doGeneralSearchButton"
                                    style="visibility: hidden;"
                                    global="false"                                        
                                    value=""  
                                    update=":appForm:growl3"
                                    title="This is the default button that accepts the enter key press" 
                                    actionListener="#{systemManager.doDefaultSearch}"
                                    process="@form"/>                    

                                <p:defaultCommand id="dashboardDefaultCommandButton" 
                                                  scope="dashboardPanel"
                                                  target="doGeneralSearchButton" />
                                <ui:remove>                    
                                <ui:include src="dashboard/admin/generalAdminTab.xhtml" />
                                </ui:remove>

                                <p:accordionPanel id="dashboardAccordion" 
                                      value="#{systemManager.dashboard.tabs}" 
                                      var="t" 
                                      widgetVar="dashboardAccordionVar"
                                      rendered="#{systemManager.dashboard.render}"
                                      multiple="false">

                                    <p:ajax event="tabChange"       
                                            immediate="true"
                                            process="@this"
                                            listener="#{systemManager.onDashboardTabChange}" />

                                    <p:tab title="#{t.name}" >
                                       
                                        <h:panelGroup rendered="#{t.id == 'System Administration'}">
                                            <ui:include src="dashboard/admin/generalAdminTab.xhtml" />
                                        </h:panelGroup>

                                    </p:tab>   

                                </p:accordionPanel>
                            </p:panel>
                        </p:splitterPanel>     
                        <p:splitterPanel styleClass="p-d-flex p-ai-center p-jc-center" 
                                         size="68" minSize="0">
                            <p:tabView id="mainTabView"   
                                       rendered="#{systemManager.mainTabView.render}"
                                       value="#{systemManager.mainTabView.tabs}" 
                                       var="t"         
                                       style="border-width: 0px;"

                                       widgetVar="mainTabViewVar">

                                <p:ajax event="tabClose" 
                                        immediate="true"
                                        process="@this"
                                        update=""
                                        listener="#{systemManager.onMainViewTabClose}" />  

                                <p:ajax event="tabChange" 
                                        immediate="true"
                                        process="@this"                                
                                        listener="#{systemManager.onMainViewTabChange}" />  


                                <p:tab title="#{t.name}" closable="true"  >

                                    <h:panelGroup rendered="#{t.id == 'System Administration'}" >
                                        <ui:include src="admin/generalAdminTab.xhtml" /> 
                                    </h:panelGroup>                           

                                </p:tab>

                            </p:tabView> 

                            <p:commandButton
                                id="doNothingButton"
                                style="visibility: hidden;"
                                global="false"                                        
                                value=""                                       
                                title="This is the default button that accepts the enter key press"                                       
                                process="@this"/> 

                            <p:defaultCommand target=":appForm:doNothingButton" />
                        </p:splitterPanel>
                    </p:splitter>

                    <p:sticky target="dashboardPanel"/>

                </p:splitterPanel>
            </p:splitter>

            <p:poll interval="60" 
                    global="false"
                    onerror="PF('connectionErrorDialog').show();"
                    listener="#{systemManager.handleKeepAlive}" />
        </h:form>
    </h:body>
</html>

